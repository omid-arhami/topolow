% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/adaptive_sampling.R
\name{adaptive_MC_sampling}
\alias{adaptive_MC_sampling}
\title{Perform Adaptive Monte Carlo Sampling (Internal)}
\usage{
adaptive_MC_sampling(
  samples_file,
  dissimilarity_matrix,
  iterations = 1,
  mapping_max_iter,
  relative_epsilon,
  folds = 20,
  num_cores = 1,
  scenario_name,
  opt_subsample = NULL,
  verbose = FALSE,
  preserve_order = FALSE
)
}
\arguments{
\item{samples_file}{Path to the CSV file with samples for the current job.}

\item{dissimilarity_matrix}{The dissimilarity matrix to be fitted.}

\item{iterations}{Number of sampling iterations per job.}

\item{mapping_max_iter}{Maximum optimization iterations for the embedding.}

\item{relative_epsilon}{Convergence threshold for the optimization.}

\item{folds}{Number of cross-validation folds.}

\item{num_cores}{Number of cores for parallel processing within this job.}

\item{scenario_name}{Name for output files, used for context.}

\item{opt_subsample}{Integer or NULL. If specified, subsamples the data for
this adaptive sampling job. A single subsample is created at the start and
reused for all iterations within this job for consistency. Default: NULL.}

\item{verbose}{Logical. If TRUE, prints progress messages. Default: FALSE.}

\item{preserve_order}{Logical. If TRUE, preserves the order of samples in the output. Default: FALSE.}
}
\value{
A \code{data.frame} containing all samples (initial and newly generated)
with their parameters and evaluated performance metrics. The data frame includes
columns for the log-transformed parameters, \code{Holdout_MAE}, and \code{NLL}.
Returns \code{NULL} if the results file was not created.
}
\description{
Core implementation of the adaptive Monte Carlo sampling algorithm. This internal
function explores the parameter space by updating the sampling distribution
based on evaluated likelihoods. It is called by the main \code{run_adaptive_sampling}
function.
}
\details{
The function performs these steps:
\enumerate{
\item Reads existing samples from the samples file
\item If \code{opt_subsample} is specified, creates a single subsample for this job
\item Calculates weighted marginal distributions for each parameter
\item For each iteration:
\itemize{
\item Samples new parameter values from the marginal distributions
\item Evaluates the parameter set via cross-validation
\item Appends results to the samples file
\item Updates the marginal distributions
}
}

The adaptive aspect comes from using likelihood-weighted KDE on previous samples
to concentrate new samples in high-likelihood regions.

\strong{Subsampling behavior}: When \code{opt_subsample} is used, a single subsample
is created at the start of this job and reused for all iterations. This ensures
consistency within the job while still allowing different jobs (in
\code{run_adaptive_sampling}) to explore different subsamples.
}
\keyword{internal}
